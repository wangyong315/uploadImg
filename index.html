<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
    <title>文件上传图片，显示缩略图</title>
    <style type="text/css">
      div {
        margin: 30px;
      }
      #imgWraper img {
        max-width: 500px;
        max-height: 400px;
      }
    </style>
</head>
<body>
  <div>
    <input id="mFile" type="file" name="file" multiple accept="image/png, image/jpeg" />
    <button onclick="showImg('700')">大图</button>
    <button onclick="showImg('100')">缩略图</button>
    <button onclick="clearImg()">清空</button>
    <button onclick="rotateImg()">旋转</button>
  </div>
  <div id="imgWraper"></div>
  <script src="https://cdn.bootcss.com/jquery/3.4.1/core.js"></script>
  <!-- http://139.199.18.143:8080/upload -->
  <script type="text/javascript">
    document.getElementById('mFile').onchange = function (ev) {
      //判断 FileReader 是否被浏览器所支持
      if (!window.FileReader) return;
      var fileList = ev.target.files;  
      Object.getOwnPropertyNames(fileList).forEach(function(key){
        printImg(fileList[key])
      });
    }

    function clearImg(params) {
      var ImgWraper = document.getElementById("imgWraper")
      ImgWraper.innerHTML = ''
    }

    function rotateImg(params) {
      console.log('rotate');
    }

    function printImg(file) {
      if(!file.type.match('image/*')){
        alert('上传的图片必须是png,gif,jpg格式！');
        ev.target.value = ""; //显示文件的值赋值为空
        return;
      }
      var reader = new FileReader();  // 创建FileReader对象
      reader.readAsDataURL(file); // 读取file对象，读取完毕后会返回result 图片base64格式的结果
      reader.onload = function(e) {
        drawToCanvas(this.result);
        // var OImg = document.createElement('img')
        // OImg.src = e.target.result;
        // document.getElementById('imgWraper').appendChild(OImg)
      }
    }

    function drawToCanvas(imgData){
      var cvs = document.createElement("canvas")
        cvs.width=1600;
        cvs.height=800;
        cvs.style.width=300;
        cvs.style.height=400;
        var ctx = cvs.getContext('2d');
        // var ratio = getPixelRatio(ctx);
        // cvs.style.width = cvs.width + 'px';
        // cvs.style.height = cvs.height + 'px';
        // cvs.width = cvs.width * ratio;
        // cvs.height = cvs.height * ratio;
        // // 放大倍数
        // ctx.scale(ratio, ratio);
        // ctx.imageSmoothingEnabled = false;
        var img = new Image;
            img.src = imgData;
            img.onload = function(){//必须onload之后再画
                ctx.drawImage(img,0,0,img.width*0.5,img.height*0.5);
                cvs.style.width=img.width*0.5;
                cvs.style.height=img.height*0.5;
                strDataURI = cvs.toDataURL();//获取canvas base64数据
            }
      document.getElementById('imgWraper').appendChild(cvs)
    }

    function showImg(params) {
      var imgList = document.getElementById("imgWraper").childNodes;
      for (let index = 0; index < imgList.length; index++) {
        const element = imgList[index];
        element.setAttribute('width', params);
      }
    }

    function getPixelRatio(context) {
      var backingStore = context.backingStorePixelRatio ||
          context.webkitBackingStorePixelRatio ||
          context.mozBackingStorePixelRatio ||
          context.msBackingStorePixelRatio ||
          context.oBackingStorePixelRatio ||
          context.backingStorePixelRatio || 1;
        return (window.devicePixelRatio || 1) / backingStore;
    };


    var ImgWraper = document.getElementById("imgWraper");
    document.onclick = function(event){
      event = event || window.event;
      var target = event.target || event.srcElement;
      var border = target.getAttribute("border");
      if (border) {
        target.setAttribute('border', '');
      } else {
        target.setAttribute('border', '1px soild #ccc');
      }
    }
  </script>
</body>
</html>